<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Uploader</title>
	<script src="http://js.live.net/v5.0/wl.js"></script>


</head>
<body>
	<script>


WL.init({ client_id: '0000000048109563'});

WL.login({ "scope": "wl.skydrive_update" }).then(
    function(response) {
        displayDialog();
        registerOnClickHandlers();
    },
    function(response) {
        log("Failed to authenticate.");
    }
);

function registerOnClickHandlers() {
    var uploadFileButton =
        document.getElementById('save-to-skydrive-upload-button');
    uploadFileButton.disabled = true;
    uploadFileButton.onclick = function() {
        closeDialog();
        saveToSkyDrive();
    };

    var fileInputElement =
        document.getElementById('save-to-skydrive-file-input');
    fileInputElement.onchange = function() {
        uploadFileButton.disabled = (fileInputElement.value === "");
    };
}

function saveToSkyDrive() {
    WL.fileDialog({ mode: 'save' }).then(
        function(response) {
            var folder = response.data.folders[0];
    
            WL.upload({
                path: folder.id,
                element: 'save-to-skydrive-file-input',
                overwrite: 'rename'
            }).then(
                function(response) {
                    log("You saved to " + response.source + ". " +
                        "Below is the result of the upload.");
                    log("");
                    log(JSON.stringify(response));
                },
                function(errorResponse) {
                    log("WL.upload errorResponse = " + JSON.stringify(errorResponse));
                }, 
                function(progress) {
                    // progress events for the upload are raised here
                }
            );
        }, function(errorResponse) {
            log("WL.fileDialog errorResponse = " + JSON.stringify(errorResponse));
        }
    );
}
                    
function log(message) {
    var child = document.createTextNode(message);
    var parent = document.getElementById('JsOutputDiv') || document.body;
    parent.appendChild(child);
    parent.appendChild(document.createElement("br"));
}
	</script>
</body>
</html>